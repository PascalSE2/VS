package sensor;

import java.util.HashMap;
import java.util.TimerTask;

import web_sensor.WebSensor;

public class WahlAlgorithmus extends TimerTask {

    private Sensor sensor;
    private String sensor_id;
    private HashMap<String, WebSensor> sensoren_service_map = new HashMap<String, WebSensor>();

    @Override
    public void run() {

        String next_koordinator = sensor_id;

        for (String it : sensoren_service_map.keySet()) {
            // -1 := it ist groeﬂer als next Koordinator
            if (next_koordinator.compareTo(it) == -1) {
                try {
                    // prueft ob Sensor noch erreichbar ist
                    sensoren_service_map.get(it).trigger();
                    // sollte der methoden aufruf noch funktionieren ist der
                    // Sensor nicht erreichbar!
                    next_koordinator = it;
                } catch (Exception e) {
                    // URL nicht erreichbar.
                    // wird beim n‰chsten trigern geloescht!
                }
            }
        }
        
       this.sensor.setKoordinator_id(next_koordinator);
       if (next_koordinator.equals(sensor_id)) {
           this.sensor.initKoordinator();
    }
       
    }

}
